<!DOCTYPE html>
<html>

<head>
  <title>Property Loss Prediction</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/w3.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ol.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/screen.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  type="text/css">
  <script src="{{ url_for('static', filename='js/ol.js') }}"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.1.2/echarts.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
  <style>
    body {
      font-family: 'PT Sans Caption', sans-serif;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6
     {
      font-family: 'PT Sans Caption', sans-serif;
      letter-spacing: 5px;
    }

    .test {
      padding: 20px 25px;
      border-radius: 5px;
      background-color: #b8d2fa;
    }

    .column {
      float: left;
      width: 20%;
    }

    /* Clear floats after the columns */
    .row:after {
      content: "";
      display: table;
      clear: both;
    }


    .button {
      display: inline-block;
      padding: 15px 25px;
      font-size: 24px;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      outline: none;
      color: black;
      background-color: #b8d2fa;
      border: none;
      border-radius: 15px;
      transition-duration: 0.4s;
    }

    .button:hover {
      background-color: #75a7f5
    }

    .text-center {
      text-align: center;
    }

    .head {
      color: white;
    }
    nav a.active { border-bottom: 3px solid #f7a278; }


    .img_padding {
      padding: 100px 100px;
    }

    .text_size {
      font-size: 20px;
    }
    #address-input-container {
      width: 608px;
    }
  </style>
</head>

<body>

  <!-- Navbar (sit on top) -->
  <div class="w3-top">
    <div class="w3-bar w3-white w3-padding w3-card" style="letter-spacing:4px;">
      <a href="#home" class="w3-bar-item w3-button">Predicting Property Rent Loss due to Climate Physical Risk</a>
      <!-- Right-sided navbar links. Hide them on small screens -->
      <div class="w3-right w3-hide-small">
        <a href="#team" class="w3-bar-item w3-button">Team</a>
        <a href="#about" class="w3-bar-item w3-button">About</a>
        <a href="#data" class="w3-bar-item w3-button">Data</a>
        <a href="#approach" class="w3-bar-item w3-button">Approach</a>
        <a href="#hurricane" class="w3-bar-item w3-button">Historical Hurricane</a>
        <a href="#prediction" class="w3-bar-item w3-button">Prediction</a>
      </div>
    </div>
  </div>

  <!-- Header -->
  <section class="hero" style="background-image: url({{ url_for('static', filename='img/banner-main.jpg') }});" id="home">
    <div class="inner-hero text-container">
      <div class="hero-text-container">
        <h1>Predicting Property Rent Loss due to Climate Physical Risk</h1>
      </div>
    </div>
  </section>

  <!-- Page content -->
  <div class="w3-content" style="max-width:1600px">

    <!-- Team Section -->
    <div class="w3-row w3-padding-64" id="team">
    </div>
    <h1 class="w3-center">The Team</h1><br>
    <div class="row" id="test1">
      <div class="column">
        <img class="text-center" src="{{ url_for('static', filename='img/Andrew.jpg') }}" alt="Hamburger Catering"
          width="300" height="300">
        <h4 class="text-center"><a>Andrew Bailey</a></h4>
      </div>
      <div class="column">
        <img class="text-center" src="{{ url_for('static', filename='img/Esther.jpg') }}" alt="Hamburger Catering"
          width="300" height="300">
        <h4 class="text-center"><a>Esther Chen</a></h4>
      </div>
      <div class="column">
        <img class="text-center" src="{{ url_for('static', filename='img/Aditya.jpg') }}" alt="Hamburger Catering"
          width="300" height="300">
        <h4 class="text-center"><a>Aditya Dave</a></h4>
      </div>
      <div class="column">
        <img class="text-center" src="{{ url_for('static', filename='img/Finnian.jpg') }}" alt="Hamburger Catering"
          width="300" height="300">
        <h4 class="text-center"><a>Finnian Meagher</a></h4>
      </div>
      <div class="column">
        <img class="text-center" src="{{ url_for('static', filename='img/Meera.jpg') }}" alt="Hamburger Catering"
          width="300" height="300">
        <h4 class="text-center"><a>Mrinalini Sharma</a></h4>
      </div>
    </div>
  </div>

  <br>
  <br>
  <br>
  <br>
  <hr>

  <!-- About Section -->
  <div class="w3-row w3-padding-64" id="about">
    <h1 class="w3-center">About</h1><br>
   <div class="w3-row m6 w3-padding-large">
      <div class="test">
        <p class="text_size">
        Coming out of the COVID-19 Pandemic, debt was cheap and banks were relatively loose in their lending standards. Cheap financing paired with explosive rent growth (particularly in Sun Belt markets) driven by migratory patterns, corporate relocations, and healthy consumer balance sheets brought a strong influx of capital into the Southeastern US real estate markets. Hot inflation brought forth more demand for inflation-resistant asset classes such as real estate, and with rents still ripping, capital continued to flow into real estate acquisitions. Certain markets overheated as risky investors chased entry cap rates down to unsustainable levels and relied too heavily on cheap floating rate debt and strong rent growth to pencil out returns. <br><br>

Everyone wanted in on the hyper growth environment of these markets but recent shifts in monetary policy (i.e., aggressive rate hikes from the Fed to battle inflation) have highlighted the potential unfortunate outcomes from risky financing and chasing growth. Even as capital allocators are reflecting on the financial viability of their portfolios and potential investments given the macroeconomic environment, we believe that investors in the real estate sector are still overlooking a key longer-term risk factor: climate change and climate physical risk. <br><br>


When macro factors put pressure on real estate owners’ ability to service debt, significant deviation from underwritten rental rates and growth can have meaningful implications (i.e., further straining ability to service debt in the short-term). Given trends in increased rates of climate events, we believe that prudent investors should consider the potential effects of climate physical risk when evaluating investments and sensitizing yield and returns. <br><br>


Climate physical risk data is difficult to aggregate, analyze, and interpret using traditional financial analytic frameworks (i.e., excel modeling) given the opacity, scope, and size of the data. Investors without the resources of a data science team may have difficulty incorporating these risks into their modeling forecasts. <br><br>


While commercial real estate investors may have loss of income covered in insurance policies, these policies are both becoming more expensive in at-risk markets and may not pay out proceeds immediately - short-term loss of income without quick repayment may put pressure on both distributable yield/return to investors and ability to cover debt without renegotiation with lenders. 


        </p>
      </div>
    </div>
  </div>

  <hr>

<!-- Data Section -->
  <div class="w3-row w3-padding-64" id="data">
    <h1 class="w3-center">Data</h1><br>
    <div class="img_padding">
      <img src="{{ url_for('static', filename='img/data.jpg') }}" class="w3-round w3-image" alt="Table Setting">
    </div>
  </div>
  <hr>



  <!-- Approach Section -->
  <div class="w3-row w3-padding-64" id="approach">
    <h1 class="w3-center">Our Approach</h1><br>
    <div class="w3-col l6 w3-padding-large">
      <div class="test">
        <h4>Approach</h4>
        <p class="text_size">Our approach is to build a tool for real estate investors, lenders, and insurers that is intuitive and easy to use to analyze the potential effects of a climate event on gross rent growth for a specific property. <br><br>

We believe our model produces a better ability to analyze downside cases than a traditional underwriting model given that: <br></p>
  <ul class="text_size">
    <li>Our model incorporates much broader/larger datasets for both macroeconomic and market data as well as climate risk and historical climate event data</li>
    <li>Utilizes a machine learning framework to optimize prediction results</li>
  </ul>

<p class="text_size">
When building and training our model, we focused on optimizing for highest Recall performance. Recall is defined as the ratio of “true positives” over the summation of “True positives” and “false negatives.” We chose this metrics because we believe our end users would rather be more conservative in their downside analysis than not - i.e., end users would rather have false positives (they underwrite worse outcomes than actually occur) than false negatives (they underwrite aggressively to better outcomes than actually occur). <br><br>

The first version of our product focuses on predicting rent growth in the event of a hurricane exposure for multifamily properties in Florida and Texas. Our goal looking forward is to expand this tool to a broader scope of geographies, climate risk exposures, and property types. <br><br>

Our final model improves on traditional underwriting from both a recall and accuracy perspective. 
 </p>
      </div>
    </div>

    <div class="w3-col l6 w3-padding-large">
       <img src="{{ url_for('static', filename='img/result.jpg') }}" class="w3-round w3-image" alt="Table Setting"
        width="900" height="770">
      <br>
      <br>
      <!--<img src="{{ url_for('static', filename='img/binary.jpg') }}" class="w3-round w3-image" alt="Table Setting"
        width="700" height="770">-->
    </div>
  </div>



  <hr>

  <!-- Historical Hurricane -->
  <div class="w3-row w3-padding-64" id="hurricane">
    <h1 class="w3-center">Historical Hurricane</h1><br>
    <p class = "w3-padding w3-center"> The training data, which is visualized on the map, spans the years 2001 to 2022 </p>

    <div class="search-container">
      <div class="search-input-container">
        <select class="search-input">
          <option value="">Year</option>
          <script>
            for (var i = 2001; i <= 2022; i++) {
              document.write("<option value='" + i + "'>" + i + "</option>");
            }
          </script>
        </select>
        <i class="fa fa-times clear-icon" style="display: none;"></i>
        <i class="fa fa-search search-icon"></i>
        <select class="search-combobox">
          <option value="1">Q1</option>
          <option value="2">Q2</option>
          <option value="3">Q3</option>
          <option value="4">Q4</option>
        </select>
      </div>
    </div>
    <div class="loading-icon" style="display: none;"></div>
    <div id="map" style="height: 700px;"></div>
    <div id="chart" style="height: 500px;"></div>
  </div>

  <!-- Prediction Section -->
  <div class="w3-row w3-padding-64" id="prediction">
    <h1 class="w3-center">Prediction</h1><br>
    <p class = "w3-padding w3-center"> Please fill in all boxes marked with a red star, as they are required fields for making a prediction </p>
    <div class="prediction-container">
      <div class="prediction-input-container input-require" id="address-input-container">
        <input type="text" class="prediction-input" id="address-input" placeholder="Address">
      </div>

      <script>
        $(function() {
            var addresses = {{ addresses|tojson }};
            $("#address-input").autocomplete({
                source: addresses,
                messages: {
                    noResults: '',
                    results: function() {}
                },
                open: function(event, ui) {
                    $('.ui-autocomplete').css('z-index', 9999);
                }
            });
        });
      </script>
      <style>
          .ui-autocomplete {
              position: absolute;
              top: 100%;
              left: 0;
              z-index: 9999;
              float: left;
              display: none;
              min-width: 160px;
              padding: 5px 0;
              margin: 2px 0 0;
              list-style: none; /* Remove the bullet points */
              font-size: 14px;
              text-align: left;
              background-color: #fff;
              border: 1px solid #ccc;
              border: 1px solid rgba(0, 0, 0, 0.15);
              border-radius: 4px;
              box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
          }

          .ui-autocomplete .ui-menu-item {
              clear: both;
              width: 100%;
              padding: 3px 15px;
              margin: 0;
              cursor: pointer;
              font-weight: normal;
              line-height: 1.42857143;
              color: #333;
              white-space: nowrap;
              list-style: none; /* Remove the bullet points */
          }

          .ui-autocomplete .ui-menu-item:hover,
          .ui-autocomplete .ui-state-active {
              color: #fff;
              text-decoration: none;
              background-color: #337ab7;
              outline: 0;
          }
      </style>

      <div class="prediction-input-container input-require">
        $</font><input type="text" class="prediction-input" placeholder="Effective Rent" id="rent-input">
      </div>

      <div class="prediction-input-container input-require">
        <!-- <input type="text" class="prediction-input" placeholder="Q1 V"> -->
        <font color="#666">Quarter</font>
        <select class="search-combobox" id='quarter-input'>
          <option value="1">Q1</option>
          <option value="2">Q2</option>
          <option value="3">Q3</option>
          <option value="4">Q4</option>
        </select>
      </div>

      <div class="prediction-input-container">
        <!-- <input type="text" class="prediction-input" placeholder="USA_SSHS V"> -->
        <font color="#666">Hurricane Category</font>
        <select class="search-combobox" id="hurricanecat-input">
          <option value="1">1 Lowest</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 Highest</option>
        </select>
      </div>
      <div class="prediction-input-container">
        <label for="occupancy-input" style="color: #666;">Occupancy </label>
        <input type="range" id="occupancy-input" class="prediction-input" min="1" max="100" value="50" oninput="updateOccupancyValue(this.value);">
        <span id="occupancy-value">50%</span>
      </div>

      <script>
        function updateOccupancyValue(value) {
          var valueSpan = document.getElementById("occupancy-value");
          valueSpan.textContent = value + "%";
        }
      </script>
      <div class="prediction-input-container">
        <label for="gust-input" style="color: #666;">Gust </label>
        <input type="range" id="gust-input" class="prediction-input" min="0" max="175" value="150" oninput="updateGustValue(this.value);">
        <span id="gust-value">150 knots</span>
        <div class="gust-description"></div>

      </div>

      <script>
        function updateGustValue(value) {
          var valueSpan = document.getElementById("gust-value");

          // Get the selected hurricane category level
          var hurricaneCatInput = document.getElementById("hurricanecat-input");
          var hurricaneCatLevel = parseInt(hurricaneCatInput.value);

          // Set the limits for the gust bar based on the selected hurricane category level
          var minGust = 0;
          var maxGust = 300;
          if (hurricaneCatLevel === 1) {
            minGust = 80;
            maxGust = 110;
          } else if (hurricaneCatLevel === 2) {
            minGust = 110;
            maxGust = 115;
          } else if (hurricaneCatLevel === 3) {
            minGust = 115;
            maxGust = 135;
          } else if (hurricaneCatLevel === 4) {
            minGust = 140;
            maxGust = 155;
          } else if (hurricaneCatLevel === 5) {
            minGust = 155;
            maxGust = 175;
          }

          // Set the range slider limits
          var gustInput = document.getElementById("gust-input");
          gustInput.min = minGust;
          gustInput.max = maxGust;

          // Convert the gust speed from knots to mph
          var mphValue = Math.round(value * 1.15078);

          // Update the gust bar value and display
          gustInput.value = value < minGust ? minGust : value > maxGust ? maxGust : value;
          valueSpan.textContent = mphValue + " mph";

          var descriptionDiv = document.querySelector('.gust-description');
          if (value >= 0 && value <= 36) {
            descriptionDiv.innerHTML = ' Safe Wind';
          } else if (value >= 37 && value <= 45) {
            descriptionDiv.innerHTML = ' Strong Wind';
          } else if (value >= 46 && value <= 65) {
            descriptionDiv.innerHTML = ' Gale Force';
          } else if (value >= 66 && value <= 88) {
            descriptionDiv.innerHTML = ' Storm Force';
          } else if (value >= 89) {
            descriptionDiv.innerHTML = ' Hurricane Force';
          }
        }

        function updateGustRange() {
          // Get the gust bar value
          var gustInput = document.getElementById("gust-input");
          var value = parseInt(gustInput.value);

          // Update the gust bar limits and value
          updateGustValue(value);
        }
          // Add event listener to hurricane category dropdown
        var hurricaneCatInput = document.getElementById("hurricanecat-input");
        hurricaneCatInput.addEventListener("change", updateGustValue);
        hurricaneCatInput.addEventListener("change", updateGustRange);
      </script>
      <div class="prediction-input-container">
        <label for="wind-input" style="color: #666;">Wind </label>
        <input type="range" id="wind-input" class="prediction-input" min="0" max="300" value="150" oninput="updateWindValue(this.value);">
        <span id="wind-value">150 knots</span>
      </div>

      <script>
        function updateWindValue(value) {
          var valueSpan = document.getElementById("wind-value");

          // Get the selected hurricane category level
          var hurricaneCatInput = document.getElementById("hurricanecat-input");
          var hurricaneCatLevel = parseInt(hurricaneCatInput.value);

          // Set the limits for the wind drag bar based on the selected hurricane category level
          var minWind = 0;
          var maxWind = 300;
          if (hurricaneCatLevel === 1) {
            minWind = 64;
            maxWind = 82;
          } else if (hurricaneCatLevel === 2) {
            minWind = 83;
            maxWind = 95;
          } else if (hurricaneCatLevel === 3) {
            minWind = 96;
            maxWind = 112;
          } else if (hurricaneCatLevel === 4) {
            minWind = 113;
            maxWind = 136;
          } else if (hurricaneCatLevel === 5) {
            minWind = 137;
            maxWind = 150;
          }

          // Set the range slider limits
          var windInput = document.getElementById("wind-input");
          windInput.min = minWind;
          windInput.max = maxWind;

          // Convert the wind speed from knots to mph
          var mphValue = Math.round(value * 1.15078);

          // Update the wind drag bar value and display
          windInput.value = value < minWind ? minWind : value > maxWind ? maxWind : value;
          valueSpan.textContent = mphValue + " mph";
        }

        function updateWindRange() {
          // Get the wind drag bar value
          var windInput = document.getElementById("wind-input");
          var value = parseInt(windInput.value);

          // Update the wind drag bar limits and value
          updateWindValue(value);
        }

        // Set the initial wind drag bar limits and value
        // updateWindValue(150);
        // Add event listener to hurricane category dropdown
        var hurricaneCatInput = document.getElementById("hurricanecat-input");
        hurricaneCatInput.addEventListener("change", updateWindValue);
        hurricaneCatInput.addEventListener("change", updateWindRange);
      </script>

    </div>
    <div class="w3-center w3-padding-64">
      <input type="submit" value="Submit" onclick="predict()" class="button">
    </div>
    <div id="prediction-message" style="text-align: center;"></div>
  </div>

  <script>
    function predict() {
      var address = document.getElementById('address-input');
      var rent = document.getElementById('rent-input');
      var quarter = document.getElementById('quarter-input');
      var occupancy = document.getElementById('occupancy-input');
      var wind = document.getElementById('wind-input');
      var gust = document.getElementById('gust-input');
      var hurricanecat = document.getElementById('hurricanecat-input');
      var message = document.getElementById("prediction-message");
      if (address.value.trim() === '') {
        message.innerHTML = 'Please fill in all the required fields (Address, Effective Rent, Quarter)';
      } else if (rent.value.trim() === '') {
        message.innerHTML = 'Please fill in all the required fields (Address, Effective Rent, Quarter)';
      } else if (quarter.value.trim() === '') {
        message.innerHTML = 'Please fill in all the required fields (Address, Effective Rent, Quarter)';
      } else {
        message.innerHTML = '';
        var url = '/predict?'
                  + 'address=' + address.value.trim()
                  + '&rent=' + rent.value.trim()
                  + '&quarter=' + quarter.value.trim()
                  + '&occupancy=' + occupancy.value.trim()
                  + '&gust=' + gust.value.trim()
                  + '&wind=' + wind.value.trim()
                  + '&hurricanecat=' + hurricanecat.value.trim();
        $.ajax({
          url: url,
          type: 'GET',
          dataType: 'json',
          mode: 'cors',
          headers: { "Access-Control-Allow-Origin": "*" },
          success: function(data) {
            // handle successful response
            console.log(data['prediction']);
            if (data['prediction'] === 0) {
              message.innerHTML = 'Quarter over Quarter Rent growth expected to be above underwriting ( > 3.5% annualized)'
            } else if (data['prediction'] === 1) {
              message.innerHTML = 'Quarter over Quarter Rent growth expected to be in line underwriting ( 2.5-3.5% annualized)'
            } else if (data['prediction'] === 2) {
              message.innerHTML = 'Quarter over Quarter Rent growth expected to be below underwriting ( < 2.5% annualized)'
            }
          },
          error: function(jqXHR, textStatus, errorThrown) {
            console.log(textStatus + ': ' + errorThrown);
          }
        });
      }
    }
  </script>

  <script src="{{ url_for('static', filename='js/map.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
  <script src="{{ url_for('static', filename='js/searchui.js') }}"></script>

</body>

</html>